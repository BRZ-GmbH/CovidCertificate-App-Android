package at.gv.brz.wallet.eval

import android.content.Context
import androidx.test.core.app.ApplicationProvider
import androidx.test.ext.junit.runners.AndroidJUnit4
import at.gv.brz.eval.data.state.DecodeState
import at.gv.brz.eval.decoder.CertificateDecoder
import at.gv.brz.eval.models.DccHolder
import at.gv.brz.wallet.data.NotificationSecureStorage
import at.gv.brz.wallet.util.NotificationUtil
import org.junit.Test
import org.junit.runner.RunWith
import org.junit.Assert.assertEquals

@RunWith(AndroidJUnit4::class)
class NotificationUtilTest {

    val context = ApplicationProvider.getApplicationContext<Context>()

    val previousInfection = "HC1:NCFOXN%TSMAHN-H3ZSUZK+.V0ET9%69EH8EMAD6VB6LX8%DB76LTSJ6NK3YTAN9I6T5XHMF2CG3V.4*2DN43U*0CEBQ/GXQFY73CIBC:GVEBBIBBL7BIB4UNAWNJKBOJJ5PNT53/FJ8FN96B2M3-6BHI7UG5V.499TXY9RH9/UPNF67J6QW6D90C KUGAACQG40SM92OGIC3LD32R44$28A9H0D3ZCL4JMYAZ+S-A5\$XKX6T2YC 35H/ITX8GL2TK96L6SR9MU9DV5 R1JMI:TU+MM0W5CZ5RNF:PI/E2$4JY/KQT2KR2Q0J 6T5 2ZCFF.KO*40YC/9T /KDV46ALK%INS4CSGFRMLNKNM8LK4NTO-7H4YNU6WJGRUQQI8MLE9F1E93QSOQE2LK5B0 18UC*VJTH2I3K47RN0TI/N/3ARV93E9\$IBPKK%%R$1MPEK+KKZ/3Z+1OVPB3AD5WM50-2CP4"

    val ratTest = "HC1:NCFOXN%TSMAHN-H3ZSUZK+.V0ET9%6-AHZP21ROR\$SIOOS%I6MN%%HQI52RKOAJNO4*J8OX4SX4+M5WLI+J53O8J.V J8\$XJK*L5R1ZP31%L1V19\$B3T93X5NVBLY5V:P4-RJ\$HBW90\$J0S9RT1XY91V1L-JI+H:PIWEGJ%44$28A9H0D3ZCL4JMYAZ+S-A5\$XKX6T2YC 35H/ITX8GL2/IEKMAB+HH+HFNHZO9HQ1*P13W12XEXO1IQ1R L* 9-V9%OKAJ9FVPQJAZM93\$UWW2QRA H99QHYOOQRA5RUXT2-RI PQVW5/O16%HAT1Z%P7BGSA3RA3/43KD3F23.+IJYCDN0TA3RK37MBZD35AL5:4A93ZE0164L:P WUQRELS400T1O09/GDBGH+9C9QF69 UP+B9+%9/82/HLIJLRKF1MF172ON3G-I7L6 JI9O3E L1+H ZQHR1D5O+CF:MT8%6SFW%:RLMUXKJWXM9.49X32UVK BGYO6\$MOZB 7G--EXPVX9AX VKXMQ29N%HLTNR10/+UW0"

    val naaTest = "HC1:NCFOXN%TSMAHN-H3ZSUZK+.V0ET9%6-AH*TA1ROR\$SIOOS%IQINP0KQI52RKW1ONO4*J8OX4SX4+M5WLI+J53O8J.V J8\$XJK*L5R1ZP3/ LGS9I\$H5X35Z97 P0V1N P-.PWVHC-J9\$B+V9WVHA.PJWHO:PDZ7:PIWEGJ%44$28A9H0D3ZCL4JMYAZ+S-A5\$XKX6T2YC 35H/ITX8GL2BTUXWP:TU/L6AW26J6ZL6JXJ\$SIQJA0O2OK0MSGFNHZO9HQ1*P13W12XEXO1IQ1R L* 9-V9%OKAJ9FVPQJAZM93\$UWW2QRA\$I9MSPDG6Z\$U*C2OQ1TK96L6SR9MU9DV5 R1JNI02P/FJBAJULJ3235S48YI.FV5DJ5DJBITNS4.\$S6ZC0JB%JBBY9BQ99Q9E\$BDZI19JDETXALVF6R955/5CA7G6M094MV3SZI$%25I3IC3Z83497Q*B%JUB*D5QT5WL+3GYHH::T1:B-MTU5CCU5KIS2/8 VVNGIMJ2+ L*.5DHNZ/RD4DDJPT:7HVH+DUP8SKS7GZKQ:H\$Q8J VEH0VL9UCO1-G"

    val vaccinationBionTechOver65Under6Months = "HC1:NCFOXN%TSMAHN-H3ZSUZK+.V0ET9%6-AH7+U1ROR\$SIOOS%IVIFLZ7LVATY8W1ONO4*J8OX4W\$C2VLWLI+J53O8J.V J8\$XJK*L5R1ZP3YXL.T1 R1VW5G H1R5GQ3GYBKUBFX9KS5W0SRZJ3T9NYJQP5QQ1I-J:PIWEG%*47%S7Y48YIZ73423ZQT\$ABKD3XW44$28A9H0D3ZCL4JMYAZ+S-A5\$XKX6T2YC 35H/ITX8GL2/IE%TE6UG+ZEAT1HQ10IGSU9ZIEQKERQ8IY1I\$HH%U8 9PS5-LH/CJTK96L6SR9MU9DV5 R13PI%F1PN1/T1%%HN9GL\$UP\$I/XK\$M8BMADCKVONX:CIGF5JNBPITRU:.UOI9:IE2OOOTIOP63E2%J6%WUEZJKS8PKDZ/G1+HL4GBLD/MGKB5: A34J3NC%*4HBTSCNT 4C%C47T+*431TN\$IK.G47HB%0WT072HFHN/SNP.0FVV/SN9Y4KCT:WC.L76V0VSNRCNGH0LB98\$Q PQ.XHU77K SVPIK/35MOF\$EUR02WEIN7DI9.\$UP2K/P7J06IXQ8QL:F5XL4 76Z6K4DAHXTIUJAMBYPME7MS$79HU-4MSHG80JT-AT7FRPOCN1D%SOII"

    val vaccinationBionTechOver65Over6Months = "HC1:NCFOXN%TSMAHN-H3ZSUZK+.V0ET9%6-AH3+U1ROR\$SIOOS%IVIFII7LVATY8QCNNO4*J8OX4W\$C2VLWLI+J53O8J.V J8\$XJK*L5R1ZP3YXL.T1 R1VW5G H1R5GQ3GYBKUBFX9KS5W0SRZJ3T9NYJQP5XYHI-J:PIWEG%*47%S7Y48YIZ73423ZQTY63KD3XW44$28A9H0D3ZCL4JMYAZ+S-A5\$XKX6T2YC 35H/ITX8GL2/IE%TE6UG+ZEAT1HQ10IGSU9ZIEQKERQ8IY1I\$HH%U8 9PS5-LH/CJTK96L6SR9MU9DV5 R13PI%F1PN1/T1%%HN9GL\$UP\$I/XK\$M8BMADCKVONX:CIGF5JNBPITRU\$YEOI9:IE2OOOTIOP63E2%J6%WUEZJKS8PKDZ/G1+HL4GBLD/MGKB5:\$I 0D%*4HBTSCNT 4C%C47T+*431TN\$IK.G47HB%0WT072HFHN/SNP.0FVV/SN9Y4KCT:WC.L76V0VSNRCNUJ0.:KYQT3LTL*81656QL35G -G7.N5-QN/V5LOPDF9J2O8LGFFD7L/-TM\$U-0TC\$T/NPP8J..CCUVU3VSMFW3G63769ON%7IHVGTU+6RML7\$G6Y B74EA73:OQYHI"

    val vaccinationPartialBionTechOver65Over6Months = "HC1:NCFOXN%TSMAHN-H3ZSUZK+.V0ET9%6-AH9+U1ROR\$SIOOS%IHGFF%GQI5MPK//OQHIZC4.OI1RM8ZA*LPKW2GHKW/F3IKJ5QH*AA:GP/HA.ASY0B*00 2%3P8:IV1I00MX3MM:KX2JN.DL3Q90LY*9DZ2+5PG+90OPN484SIBRU4SI.J9WVHWVH+ZE2YH3W1VLIWQHYZKOP6OH6XO9IE5IVU5P2-GA*PE1H6IO2OO9\$G40GHMKN4NN3F85QNCY0O%0768:0LPHN6D7LLK*2HG%89UV-0LZ 2S-O:S9UZ4+FJE 4Y3LL/II 0OC9JU0D0HT0HB2PR78+FFZI9\$JAQJKKGLEEQ%YBHXM*%NH\$RSC9\$DF7Y0-FH+X4TFH2E1%IH*LPIGF+X4AOVSD1%48:P4YA7LHK9MOFT5+89:ZPCHP /0VXF3UQFJ6GL28LHXOAYJAXZQSH9R\$FXQGDVBK*RZP3:*DG1W7SGT$7S%RMSGYZQ4H99\$R2-JIS77%F6TI G7IY1* H2O1TS3TTC+/5/SF22W%3UE9JQL2YLBF/495QM/M7 LP9J6LQS4TC6T*K3L+9G5UL+U3-39KGYVIZML9QD+08FLF3JM3/PFJHBUDMKS12F4KHGWT MI"

    val vaccinationAstraOver65Over6Months = "HC1:NCFOXN%TSMAHN-H3ZSUZK+.V0ET9%6-AH4+U1ROR\$SIOOS%I HFP0KQI53OKI7ONO4*J8OX4W\$C2VLWLI+J53O8J.V J8\$XJK*L5R1ZP3YXL.T1 R1VW5G H1R5GQ3GYBKUBFX9KS5W0SRZJ3T9NYJQP5TU9I-J:PIWEG%*47%S7Y48YIZ73423ZQTY63KD3XW44$28A9H0D3ZCL4JMYAZ+S-A5\$XKX6T2YC 35H/ITX8GL2/IE%TE6UG+ZEAT1HQ10IGSU9ZIEQKERQ8IY1I\$H3:U8 9QS5-LH/CJTK96L6SR9MU9DV5 R13PI%F1PN1/T1%%HN9GL\$UP\$I/XK\$M8TH1DCKVONX:CIGF5JNBPITRU-%MOI9:IE2OOOTIOP63E2%J6%WU7R3D5VTI5M5557TLXKSB5KFJ.KJDZC 0J9JAX.B-QFDIAS.C4-9OKEH-B+IL69D3BHABIIBI*DL3XN9QD/EMV8KMPDBLEH-BL1H6TK-CI:UL\$ODI7AVPL32K01K%XG:RVTTH5VM8W6/NE07QWMFO+U8*B*OJ-W676GCOFNGMHXEHF3YSDSFAN*TDP3H U-PU*J38*B1/3C3Q/:6+1GZCKSS3--V%-1E/SV 58209NH34"

    val vaccinationAstraUnder65Under6Months = "HC1:NCFOXN%TSMAHN-H3ZSUZK+.V0ET9%6-AH8+U1ROR\$SIOOS%IBEF-AIQI5-QKJMKNO4*J8OX4W\$C2VLWLI+J53O8J.V J8\$XJK*L5R1ZP3YXL.T1 R1VW5G H1R5GQ3GYBKUBFX9KS5W0SRZJ3T9NYJQP5UU9I-J:PIWEG%*47%S7Y48YIZ73423ZQT\$ABKD3XW44$28A9H0D3ZCL4JMYAZ+S-A5\$XKX6T2YC 35H/ITX8GL2/IE%TE6UG+ZEAT1HQ10IGSU9ZIEQKERQ8IY1I\$H3:U8 9QS5-LH/CJTK96L6SR9MU9DV5 R13PI%F1PN1/T1%%HN9GL\$UP\$I/XK\$M8TH1DCKVONX:CIGF5JNBPITRU YEOI9:IE2OOOTIOP63E2%J6%WU7R3D5VTI5M5557TLXKSB5KFJ3JJW42D3E6LF20HFJC3DAYJDPKD4JB2E9Z3E8AE-QD+PB.QCD-H/8O3BEQ8L9VNT7A6LFCD9KWNHPA%8L+5INKE\$JDVPL32K01KCZGVT163W ANCI1%4BCKT9/6J91EDWL6CZP7N.G7ZUM1S13TPWFN:M/AQ3%U2YQBK5MQADJ6E0F2I51DF%:F3FJKJ51NAUAQC-CYHE0009130%H"

    val vaccinationJanssenUnder65Under6Months = "HC1:NCFOXN%TSMAHN-H3ZSUZK+.V0ET9%6-AH7+U1ROR\$SIOOS%IUFF\$E0LVAZ 809GNO4*J8OX4W\$C2VLWLI+J53O8J.V J8\$XJK*L5R1ZP3YXL.T1 R1VW5G H1R5GQ3GYBKUBFX9KS5W0SRZJ3T9NYJQP5$%PI-J:PIWEG%*47%S%*48YIZ73423ZQT\$ABKD3XW44$28A9H0D3ZCL4JMYAZ+S-A5\$XKX6T2YC 35H/ITX8GL2/IE%TE6UG+ZEAT1HQ10IGSU9ZIEQKERQ8IY1I\$HH%U8 9SU9-LH 43TK96L6SR9MU9DV5 R13PI%F1PN1/T1%%HN9GL\$UP\$I/XK\$M8TH1DCKVONX:CIGF5JNBPITRU:.UOI9:IE2OOOTIOP63E2%J6%WU-YNLZURRH%WULID*K8EIA9QHA\$PIIGUGAQVQR95W165X7EHLEL62/4CA799MC\$Q3R69 OZDP*DPK+Q92SYW6MIRNCQIW6SA7G6MBYO+JQLHP71RSZ6FT5D75W9A999H76IGC.3MMLGE:TP/I33K09JHOK*IRVPH*620U0COVH V-TP-1F..10MPE:AR:J2RE1\$GOSESFWVJBZXJ8.Q+U9UDUPCWPD3YGN.\$MC:R6202XE43"

    val vaccinationJanssenUnder65Over6Months = "HC1:NCFOXN%TSMAHN-H3ZSUZK+.V0ET9%6-AH3+U1ROR\$SIOOS%IUFF7A2LVAZ 8ILINO4*J8OX4W\$C2VLWLI+J53O8J.V J8\$XJK*L5R1ZP3YXL.T1 R1VW5G H1R5GQ3GYBKUBFX9KS5W0SRZJ3T9NYJ0AG+PPYE9/MVGL2*LA 436IAXPMHQ1*P13W1+ZEVYHOH6CN5B\$FNXUJRH0LH%Y2 UQ7S7TK24H9GUE/P3SEGKIJIE9MIHJ6W48UK.GCY0$2PY\$BIE9WT0K3M9UVZSVV*001H--8UE9GB55B9-NT0 2$$0X4PCY0+-CVYCDEBD0HX2JR$4O1K8KES/F-1JS-KEA0Y%54N4B-S-*O5W41FDRX2K:DOA72E1%IH*LPIGF+X4AOV:D13HH40P5JL3D1LF1CEF/HL7E1Z0L3/CBA391TLZI19JA2K7VA\$IJVTI ZJY1B QTOD3CQSP\$SR\$S3NDC9UOD3Y.TJET9G3:ZJ83BDPSCFTB.SBVTGLJK*QYLDR4DM1D:OSAVI38UPDM/2V%+L5V4W*49LVR9BDPCWI8:GJD2WAQ73M9KW9ZM5WYN7DF2OS.TRZ3OF*BLVN-%6U.L.AR9QV-+4C45.NVEEB2SQ2X9K7E1BI"

    val vaccinationBionTechUnder65Over9Months = "HC1:NCFOXN%TSMAHN-H3ZSUZK+.V0ET9%6-AH7+U1ROR\$SIOOS%INIFQ$0LVAGZ8YVGNO4*J8OX4W\$C2VLWLI+J53O8J.V J8\$XJK*L5R1ZP3YXL.T1 R1VW5G H1R5GQ3GYBKUBFX9KS5W0SRZJ3T9NYJQP5RS5I-J:PIWEG%*47%S7Y48YIZ73423IFT4I3KD3XW44$28A9H0D3ZCL4JMYAZ+S-A5\$XKX6T2YC 35H/ITX8GL2/IE%TE6UG+ZEAT1HQ13W1:O1 SI5K1*TB3:U-1VVS1UU15%HTNIPPAAMI PQVW5/O16%HAT1Z%PHOP+MMBT16Y5+Z9XV7G+SB.V Q5-L9SK09%BM+87LPMIH-O92UQGJ59%RYQE4S2UF2IRI WUZM9 \$UBR2V9G/69NLERI8ZH8I-BBLD/MGKB5NHJG 0*GB%*4HBTSCNT 4C%C47T+*431TN\$IK.G47HB%0WT072HFHN/SNP.0FVV/SN9Y4KCT:WC.L76V0VSNRCNUJ0.:KYQT3LTL*89-PXHR8A7TEU6KL.U50+9LBRS05/P7RPVP5H7LU6XQ D1B%97.ENV4F1VG51A.E5TJ/3ACNRP+PK7QWT4V1U3BQ:\$A-DFZC0:%L7YM410I:E/1"

    fun dccHolderFrom(string: String): DccHolder {
        return (CertificateDecoder.decode(string) as DecodeState.SUCCESS).dccHolder
    }

    @Test fun testCertificatesEligibleForVaccinationBoosterNotification() {
        assertEquals(0, NotificationUtil().certificatesEligibleForNotification(listOf(dccHolderFrom(previousInfection))).size)
        assertEquals(0, NotificationUtil().certificatesEligibleForNotification(listOf(dccHolderFrom(ratTest))).size)
        assertEquals(0, NotificationUtil().certificatesEligibleForNotification(listOf(dccHolderFrom(naaTest))).size)
        assertEquals(0, NotificationUtil().certificatesEligibleForNotification(listOf(dccHolderFrom(vaccinationBionTechOver65Under6Months))).size)
        assertEquals(1, NotificationUtil().certificatesEligibleForNotification(listOf(dccHolderFrom(vaccinationBionTechOver65Over6Months))).size)
        assertEquals(0, NotificationUtil().certificatesEligibleForNotification(listOf(dccHolderFrom(vaccinationPartialBionTechOver65Over6Months))).size)
        assertEquals(1, NotificationUtil().certificatesEligibleForNotification(listOf(dccHolderFrom(vaccinationAstraOver65Over6Months))).size)
        assertEquals(0, NotificationUtil().certificatesEligibleForNotification(listOf(dccHolderFrom(vaccinationAstraUnder65Under6Months))).size)
        assertEquals(0, NotificationUtil().certificatesEligibleForNotification(listOf(dccHolderFrom(vaccinationJanssenUnder65Under6Months))).size)
        assertEquals(1, NotificationUtil().certificatesEligibleForNotification(listOf(dccHolderFrom(vaccinationJanssenUnder65Over6Months))).size)
        assertEquals(1, NotificationUtil().certificatesEligibleForNotification(listOf(dccHolderFrom(vaccinationBionTechUnder65Over9Months))).size)
    }
}